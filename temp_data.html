//////////////////////////////////////////////////////////
//////////////////////////////////////////////


function fetchData2(drugName) {
    // Make AJAX request to PHP script
    $.ajax({
      type: "POST",
      url: "",
      data: {
        drugName: drugName
      },
      success: function(data) {
        drug_des_parent = JSON.parse(data);

        generate_table();
        // You can do further processing here
      },
      error: function(xhr, status, error) {
        console.error("Error: " + error);
      }
    });
  }

  
  function fetchData3(drugName2) {
    // Make AJAX request to PHP script
    $.ajax({
      type: "POST",
      url: "",
      data: {
        drugName2: drugName2
      },
      success: function(data) {
        // Handle the returned data
        drug_des_parent = JSON.parse(data);

        generate_table();
        // You can do further processing here
      },
      error: function(xhr, status, error) {
        console.error("Error: " + error);
      }
    });
  }






  //////////////////////////////////////////////////////////////////////////////////////

  function generate_table() {

    var div = document.querySelector('.parent_description');
    div.classList.toggle('show');
    var div = document.querySelector('.blur_the_background');
    div.classList.toggle('show');

    var name = document.querySelector('#drugname');
    name.innerHTML = clickedData.id;

    let dataobject = drug_des_parent['0'];

    // Function to populate the table
    function populateTable() {
      const tableBody = document.getElementById('compoundTableBody');
      tableBody.innerHTML = '';

      Object.entries(dataobject).forEach(([key, value]) => {
        const row = document.createElement('tr');

        const keyCell = document.createElement('td');
        keyCell.textContent = key;
        row.appendChild(keyCell);

        const valueCell = document.createElement('td');
        row.appendChild(valueCell);
        valueCell.textContent = value;

        if (keyCell.innerText === 'CROSS_REFERENCES_CELL_LINES') {
          let text_change = valueCell.innerHTML;
          var formattedData = formatData(text_change);
          // Use innerHTML instead of textContent to render HTML tags
          valueCell.innerHTML = formattedData;

        } else if (keyCell.innerText === 'COMMENTS') {
          let text_change = valueCell.innerHTML;
          var formattedData = formatData2(text_change);
          // Use innerHTML instead of textContent to render HTML tags
          valueCell.innerHTML = formattedData;

        } else
        if (keyCell.innerText === 'REFERENCE_ID') {
          let text_change = valueCell.innerHTML;
          var formattedData = formatData3(text_change);
          // Use innerHTML instead of textContent to render HTML tags
          valueCell.innerHTML = formattedData;
        }

        tableBody.appendChild(row);
      });
    }

    function formatData(data) {
      var lines = data.split('|');
      var formattedLines = [];

      for (var i = 0; i < lines.length - 1; i++) {
        var parts = lines[i].split(';');
        var formattedText = '<b>' + parts[0] + '</b>' + '<a href="https://cancer.sanger.ac.uk/cosmic" target="_blank">' + parts[1] + '</a>';
        formattedLines.push(formattedText);
      }


      return formattedLines.join('<br>');
    }

    function formatData2(data) {
      var lines = data.split('|');
      var formattedLines = [];


      for (var i = 0; i < lines.length - 1; i++) {
        var parts = lines[i].split(':');
        var formattedText = '<b>' + parts[0] + '</b>' + ':' + parts[1];
        formattedLines.push(formattedText);
      }



      return formattedLines.join('<br>');
    }

    function formatData3(data) {

      var lines = data.split('|');
      var formattedLines = [];

      for (var i = 0; i < lines.length - 1; i++) {
        var parts = lines[i].split('=');
        var formattedText = '<b>' + parts[0] + '</b>' + '=' + parts[1];
        formattedLines.push(formattedText);
      }



      return formattedLines.join('<br>');
    }
    // Call the function to populate the table
    populateTable();
    // const toggleForm = document.querySelector('.toggle');
    const compoundTable = document.querySelector('table');
  }



  
  //////////////////////////////////////////////////////////////////////////////////////
 
 
  <?php
  
  // Check if drugName is set in the POST request
  if (isset($_POST['drugName'])) {
  
    include 'fetchdata.php';
    $drugName = $_POST['drugName'];
  
    // Use prepared statement to prevent SQL injection
    $stmt = $conn->prepare("SELECT * FROM compounds WHERE COMPOUND_NAME = ?");
    $stmt->bind_param("s", $drugName);
    $stmt->execute();
  
    // Get the result
    $result = $stmt->get_result();
  
    // Fetch data as an associative array
    $data = $result->fetch_all(MYSQLI_ASSOC);
  
    // Close the statement
    $stmt->close();
  
    // Return the data as JSON
    echo json_encode($data);
    $conn->close();
    exit();
  }
  
  // Close the database connection
  ?>
  <?php
  // Check if drugName is set in the POST request
  if (isset($_POST['drugName2'])) {
  
    include 'fetchdata.php';
    $drugName2 = $_POST['drugName2'];
  
    // Use prepared statement to prevent SQL injection
    $stmt = $conn->prepare("SELECT * FROM cellline WHERE CELL_LINE_NAME = ?");
    $stmt->bind_param("s", $drugName2);
    $stmt->execute();
  
    // Get the result
    $result = $stmt->get_result();
  
    // Fetch data as an associative array
    $data = $result->fetch_all(MYSQLI_ASSOC);
  
    // Close the statement
    $stmt->close();
  
    // Return the data as JSON
    echo json_encode($data);
    // echo $drugName2;
    $conn->close();
    exit();
  }
  
  // Close the database connection
  
  ?>
  //////////////////////////////////////////////////////

  /